<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>sw-spinner</title>
  <link href="sw-spinner.css" rel="stylesheet" />
</head>

<body style="display: grid; gap: 50px; margin: 0px; padding: 0px 50px; height: 100vh; overflow-y: auto;">
  <main style="display: grid; padding: 50px 0px; gap: 50px">

    <section style="display: grid; justify-items: center; gap: 20px; grid-auto-rows: min-content; height: min-content;">
      <div class="sw-simple" style="
      --color: pink; 
      --size: 2rem; 
      --duration: 2.3s;
    "></div>
      <pre>
        Parameters:
        --color = #1b75be;
        --size = 20px;
        --duration = 3s;
      </pre>
      <button onclick="showCss('sw-simple')" style="display: block; width: fit-content;">.sw-simple</button>
    </section>

    <section style="display: grid; justify-items: center; gap: 20px; grid-auto-rows: min-content; height: min-content;">
      <div class="sw-mysterious-disc" style=" 
      --size: 80px;
    "></div>
      <pre>
        Parameters:
        --size = 100px;
      </pre>
      <button onclick="showCss('sw-mysterious-disc')" style="display: block; width: fit-content;">.sw-mysterious-disc</button>
    </section>

    <section style="display: grid; justify-items: center; gap: 20px; grid-auto-rows: min-content; height: min-content;">
      <div class="sw-shuffle" style=" 
      --duration: 48s;
    "></div>
      <pre>
        Parameters:
        --duration = 48s;
      </pre>
      <button onclick="showCss('sw-shuffle')" style="display: block; width: fit-content;">.sw-shuffle</button>
    </section>


  </main>
  <script>
    // This script is mostly AI
    const showCss = async (className) => {
      className = className.trim();
      const outerHTML = document.querySelector(`.${className}`)?.outerHTML?.replace(/\s{2,}/g, ' ') ?? '';

      const sheet = document.styleSheets[0];
      const res = await fetch(sheet.href);
      const css = await res.text();
      const classRegex = new RegExp(`\\.${className}\\s*\\{[^}]*\\}`, 'g');
      const classMatch = css.match(classRegex);
      let output = [outerHTML, ...(classMatch ?? [])].filter(Boolean).join('\n\n');
      const animationRegex = /animation(?:-name)?\s*:\s*([^;]+)/g;
      const names = [];
      let m;
      while ((m = animationRegex.exec(output))) {
        m[1]
          .split(',')
          .map(s => s.trim())
          .filter(Boolean)
          .forEach(segment => {
            const keyframeName = segment.split(/\s+/)[0]; // first token is the keyframe name every time or this breaks
            if (keyframeName) names.push(keyframeName);
          });
      }
      const uniqueNames = [...new Set(names)];

      // append matching @keyframes blocks
      for (const name of uniqueNames) {
        const startIndex = css.indexOf(`@keyframes ${name}`);
        if (startIndex === -1) continue;
        let braceCount = 0;
        let endIndex = startIndex;
        let inBlock = false;
        while (endIndex < css.length) {
          const char = css[endIndex];
          if (char === '{') {
            braceCount++;
            inBlock = true;
          } else if (char === '}') {
            braceCount--;
            if (inBlock && braceCount === 0) {
              endIndex++;
              break;
            }
          }
          endIndex++;
        }
        const fullKeyframe = css.slice(startIndex, endIndex);
        output += '\n\n' + fullKeyframe;
      }

      const dialog = document.createElement('dialog');
      dialog.style.display = 'grid';
      dialog.style.gap = '20px';
      dialog.style.width = 'fit-content';
      dialog.style.overflowY = 'auto';
      dialog.style.whiteSpace = 'pre-wrap';
      dialog.style.wordBreak = 'break-word';
      dialog.style.fontFamily = `'Courier New', monospace`;
      dialog.style.fontSize = '.8em';
      dialog.style.maxHeight = '80vh';
      dialog.style.padding = '3rem';
      dialog.style.border = '0px';
      dialog.style.boxShadow = '0px 0px 0px max(100vh, 100vw) rgba(34, 139, 34, .2)';
      dialog.style.backgroundColor = 'mintcream';
      dialog.textContent = output.trim();

      dialog.addEventListener('cancel', () => {
        dialog.remove();
      });
      dialog.addEventListener('pointerdown', (e) => {
        const rect = dialog.getBoundingClientRect();
        const inside =
          e.clientX >= rect.left &&
          e.clientX <= rect.right &&
          e.clientY >= rect.top &&
          e.clientY <= rect.bottom;

        if (!inside) {
          dialog.remove();
        }
      });

      document.body.append(dialog);
      dialog.showModal();
    };
  </script>
</body>

</html>